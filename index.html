<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub do Canal - Downloads e Links</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Configurações de Estilo Personalizado -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            dark: '#0a0a0f',
                            card: '#13131f',
                            accent: '#6366f1', // Indigo Principal
                            glow: '#818cf8',
                            success: '#10b981',
                            error: '#ef4444'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } },
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 15px rgba(99, 102, 241, 0.2)' },
                            '50%': { boxShadow: '0 0 25px rgba(99, 102, 241, 0.5)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0a0a0f; }
        ::-webkit-scrollbar-thumb { background: #3730a3; border-radius: 4px; }
        
        /* Fundo Animado Otimizado */
        .bg-animated {
            background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #0a0a0f 100%);
            position: relative;
        }
        .bg-animated::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4wNSkiLz48L3N2Zz4=');
            opacity: 0.5;
            z-index: 0;
            pointer-events: none;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(19, 19, 31, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Toast Notification */
        .toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 100;
            right: 30px;
            bottom: 30px;
            font-size: 14px;
            transform: translateY(100%);
            transition: all 0.3s;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
        .toast.show {
            visibility: visible;
            transform: translateY(0);
        }

        /* Layout Grid PC */
        @media (min-width: 1024px) {
            #main-layout {
                display: grid;
                grid-template-columns: 380px 1fr;
                gap: 2.5rem;
                max-width: 1200px;
                margin: 0 auto;
                height: 85vh;
            }
            #profile-section {
                height: 100%;
                position: sticky;
                top: 0;
            }
            #links-section {
                overflow-y: auto;
                padding-right: 0.5rem;
            }
        }
    </style>
</head>
<body class="bg-brand-dark text-white min-h-screen overflow-x-hidden bg-animated font-sans selection:bg-brand-accent selection:text-white">

    <!-- === TOAST NOTIFICATION === -->
    <div id="toast" class="toast glass border-l-4 border-brand-accent flex items-center gap-3 text-left">
        <div id="toast-icon"><i class="fa-solid fa-info-circle"></i></div>
        <div>
            <h4 id="toast-title" class="font-bold text-sm">Notificação</h4>
            <p id="toast-msg" class="text-xs text-gray-300">Mensagem aqui</p>
        </div>
    </div>

    <!-- === MODAL DE TERMOS === -->
    <div id="terms-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-md hidden transition-opacity duration-300">
        <div class="glass p-8 rounded-3xl max-w-md w-full mx-4 text-center border border-red-500/20 shadow-[0_0_60px_rgba(220,38,38,0.15)] animate-slide-up">
            <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-red-700 rounded-2xl rotate-3 flex items-center justify-center mx-auto mb-6 shadow-lg">
                <i class="fa-solid fa-shield-halved text-white text-3xl -rotate-3"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">Termos de Uso</h2>
            <p class="text-gray-400 text-sm mb-6">
                Para acessar o conteúdo exclusivo e downloads, você precisa concordar com as regras da comunidade.
            </p>
            <div class="text-left bg-black/40 p-4 rounded-xl text-xs text-gray-400 mb-6 h-32 overflow-y-auto border border-white/5 space-y-2">
                <p><i class="fa-solid fa-check text-green-500 mr-2"></i> Uso estritamente pessoal.</p>
                <p><i class="fa-solid fa-check text-green-500 mr-2"></i> Proibida a revenda de arquivos.</p>
                <p><i class="fa-solid fa-check text-green-500 mr-2"></i> Respeito nos comentários e comunidade.</p>
                <p><i class="fa-solid fa-check text-green-500 mr-2"></i> O canal não se responsabiliza por banimentos em jogos.</p>
            </div>
            <button onclick="acceptTerms()" class="w-full bg-gradient-to-r from-red-600 to-red-800 hover:from-red-500 hover:to-red-700 text-white font-bold py-3.5 rounded-xl transition-all hover:scale-[1.02] active:scale-95 shadow-lg shadow-red-900/40">
                LI E CONCORDO
            </button>
        </div>
    </div>

    <!-- === MODAL DE LOGIN (GOOGLE ONLY) === -->
    <div id="auth-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm hidden">
        <div class="glass p-8 rounded-3xl max-w-sm w-full mx-4 relative animate-slide-up border border-brand-accent/20">
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-brand-accent to-brand-glow rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-brand-accent/20">
                    <i class="fa-solid fa-lock text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold">Arquivo Protegido</h3>
                <p class="text-gray-400 text-xs mt-2 px-4">Para manter a qualidade e segurança da comunidade, este download requer identificação.</p>
            </div>

            <div class="space-y-4">
                <button id="btn-google" class="w-full bg-white text-gray-800 font-bold py-3.5 rounded-xl flex items-center justify-center gap-3 hover:bg-gray-100 transition-all hover:scale-[1.02] shadow-lg">
                    <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="Google">
                    Entrar com Google
                </button>
                <p class="text-[10px] text-gray-500 text-center">
                    Apenas contas Google são aceitas para downloads.
                </p>
            </div>
        </div>
    </div>

    <!-- === LOADING SCREEN === -->
    <div id="loading-screen" class="fixed inset-0 z-40 bg-[#0a0a0f] flex flex-col items-center justify-center">
        <div class="relative">
            <div class="w-16 h-16 border-4 border-brand-card rounded-full"></div>
            <div class="absolute top-0 left-0 w-16 h-16 border-4 border-brand-accent border-t-transparent rounded-full animate-spin"></div>
        </div>
        <p class="mt-4 text-brand-accent font-semibold tracking-widest text-xs animate-pulse">INICIALIZANDO SISTEMA...</p>
    </div>

    <!-- === CONTEÚDO PRINCIPAL === -->
    <div id="app-content" class="min-h-screen p-4 lg:flex lg:items-center lg:justify-center hidden">
        
        <div id="main-layout" class="w-full">
            
            <!-- PERFIL -->
            <aside id="profile-section" class="glass rounded-3xl p-6 lg:p-10 flex flex-col items-center justify-center text-center shadow-2xl animate-fade-in relative overflow-hidden">
                <!-- Efeito Background -->
                <div class="absolute top-0 inset-x-0 h-40 bg-gradient-to-b from-brand-accent/10 to-transparent"></div>

                <!-- Status User -->
                <div class="absolute top-5 right-5 z-20">
                    <div id="user-pill" class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/60 backdrop-blur-md border border-white/5 cursor-pointer hover:bg-black/80 transition-colors group">
                        <div id="status-dot" class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></div>
                        <span id="status-text" class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">Visitante</span>
                        <i id="logout-icon" class="fa-solid fa-sign-out-alt ml-1 text-xs text-red-400 hidden group-hover:inline-block"></i>
                    </div>
                </div>

                <div class="relative z-10 mt-4">
                    <div class="relative inline-block group">
                        <div class="absolute -inset-1 bg-gradient-to-r from-brand-accent to-purple-600 rounded-full blur opacity-40 group-hover:opacity-75 transition duration-500"></div>
                        <img id="profile-img" src="https://via.placeholder.com/150" alt="Avatar" 
                             class="relative w-32 h-32 lg:w-40 lg:h-40 rounded-full border-4 border-[#13131f] object-cover shadow-2xl">
                    </div>

                    <h1 id="channel-name" class="text-2xl lg:text-3xl font-extrabold text-white mt-6 mb-2 tracking-tight">Carregando...</h1>
                    <p id="channel-bio" class="text-gray-400 text-sm max-w-[250px] mx-auto leading-relaxed">...</p>

                    <!-- Redes Sociais -->
                    <div id="social-icons" class="flex justify-center gap-3 mt-8 flex-wrap">
                        <!-- JS Injects Here -->
                    </div>
                </div>
            </aside>

            <!-- LINKS E CONTEÚDO -->
            <main id="links-section" class="mt-6 lg:mt-0 flex flex-col h-full">
                
                <!-- Barra de Pesquisa (NOVA FUNÇÃO) -->
                <div class="glass rounded-2xl p-2 mb-6 flex items-center gap-3 sticky top-0 z-30 shadow-lg">
                    <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-gray-400">
                        <i class="fa-solid fa-search"></i>
                    </div>
                    <input type="text" id="search-input" placeholder="Buscar download, vídeo ou link..." 
                           class="bg-transparent border-none outline-none text-sm text-white placeholder-gray-500 w-full h-full">
                </div>
                
                <div id="links-list" class="flex flex-col gap-4 pb-10">
                    <!-- JS Injects Buttons Here -->
                </div>

                <footer class="mt-auto pt-8 text-center">
                    <p class="text-gray-600 text-xs">
                        &copy; 2026 Canal Geilson. <span class="text-brand-accent">Todos os direitos reservados.</span>
                    </p>
                </footer>
            </main>
        </div>
    </div>

    <!-- === LÓGICA JAVASCRIPT === -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getRemoteConfig, fetchAndActivate, getValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-remote-config.js";
        import { getAuth, signInAnonymously, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // CONFIGURAÇÃO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyBfw8u0YwfKdiGNDjWPd0Vxjf6yQuDNKRA",
            authDomain: "canal-geilson.firebaseapp.com",
            projectId: "canal-geilson",
            storageBucket: "canal-geilson.firebasestorage.app",
            messagingSenderId: "442170184472",
            appId: "1:442170184472:web:77e83150b24c9eccee846d",
            measurementId: "G-7CLH8J6PPF"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const remoteConfig = getRemoteConfig(app);
        remoteConfig.settings = { minimumFetchIntervalMillis: 1000, fetchTimeoutMillis: 10000 };

        // ESTADO
        let state = {
            user: null,
            links: [],
            pendingUrl: null
        };

        // DADOS PADRÃO (FALLBACK)
        const defaultData = {
            profile: {
                name: "Canal Geilson",
                bio: "Tutoriais, Mods e Tecnologia. Conteúdo exclusivo para membros.",
                image: "https://api.dicebear.com/7.x/avataaars/svg?seed=Geilson&backgroundColor=b6e3f4"
            },
            links: [
                { title: "Inscreva-se no Canal", url: "https://youtube.com", icon: "fa-youtube", type: "social", color: "from-red-600 to-red-800" },
                { title: "Pack Otimização V2", url: "https://google.com", icon: "fa-bolt", type: "download", color: "from-yellow-600 to-orange-700" },
                { title: "GTA San Andreas Mod", url: "https://google.com", icon: "fa-gamepad", type: "download", color: "from-green-600 to-emerald-800" },
                { title: "Meu Setup 2024", url: "https://amazon.com", icon: "fa-computer", type: "external" }
            ],
            social: [
                { icon: "fa-instagram", url: "#" },
                { icon: "fa-discord", url: "#" },
                { icon: "fa-twitter", url: "#" }
            ]
        };

        // --- INICIALIZAÇÃO ---
        async function init() {
            // Verificar Termos
            if (!localStorage.getItem('terms_accepted')) {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('terms-modal').classList.remove('hidden');
                return;
            }

            // Auth Listener
            onAuthStateChanged(auth, (user) => {
                state.user = user;
                updateUserUI(user);
                if (!user) signInAnonymously(auth).catch(() => {});
            });

            // Fetch Data
            try {
                await fetchAndActivate(remoteConfig);
                const json = getValue(remoteConfig, 'site_data').asString();
                const data = json ? JSON.parse(json) : defaultData;
                
                // Armazena links no estado para o filtro
                state.links = data.links;
                
                renderProfile(data.profile, data.social);
                renderLinks(state.links);
            } catch (e) {
                console.warn("Usando dados padrão", e);
                state.links = defaultData.links;
                renderProfile(defaultData.profile, defaultData.social);
                renderLinks(defaultData.links);
            } finally {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
            }
        }

        // --- RENDERIZAÇÃO ---
        function renderProfile(profile, social) {
            document.getElementById('channel-name').textContent = profile.name;
            document.getElementById('channel-bio').textContent = profile.bio;
            if(profile.image) document.getElementById('profile-img').src = profile.image;

            const container = document.getElementById('social-icons');
            container.innerHTML = social.map(s => `
                <a href="${s.url}" target="_blank" class="w-10 h-10 rounded-xl bg-white/5 border border-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-brand-accent hover:border-brand-accent transition-all duration-300 hover:-translate-y-1">
                    <i class="fa-brands ${s.icon}"></i>
                </a>
            `).join('');
        }

        function renderLinks(links) {
            const list = document.getElementById('links-list');
            list.innerHTML = '';

            if (links.length === 0) {
                list.innerHTML = `<div class="text-center text-gray-500 mt-10"><i class="fa-solid fa-ghost text-2xl mb-2"></i><br>Nenhum link encontrado.</div>`;
                return;
            }

            links.forEach((link, idx) => {
                const isLock = link.type === 'download' && (!state.user || state.user.isAnonymous);
                const bgClass = link.color ? `bg-gradient-to-r ${link.color}` : 'bg-brand-card hover:border-brand-accent/30 border border-white/5';
                
                const btn = document.createElement('div');
                btn.className = `group relative overflow-hidden rounded-2xl p-1 cursor-pointer transition-all duration-300 hover:scale-[1.01] hover:shadow-xl animate-slide-up`;
                btn.style.animationDelay = `${idx * 0.05}s`;

                btn.innerHTML = `
                    <div class="${bgClass} h-full w-full rounded-xl p-4 relative z-10 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-lg bg-black/20 backdrop-blur-sm flex items-center justify-center text-xl shadow-inner">
                                <i class="fa-solid ${link.icon}"></i>
                            </div>
                            <div class="flex flex-col">
                                <span class="font-bold text-white text-base lg:text-lg leading-tight flex items-center gap-2">
                                    ${link.title} 
                                    ${isLock ? '<i class="fa-solid fa-lock text-[10px] bg-black/30 px-1.5 py-0.5 rounded text-gray-300"></i>' : ''}
                                </span>
                                <span class="text-[10px] text-white/70 uppercase tracking-widest font-semibold mt-1">
                                    ${link.type === 'download' ? 'Download Seguro' : 'Link Externo'}
                                </span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                             <!-- Botão Copiar (NOVO) -->
                             <button class="copy-btn w-8 h-8 rounded-full bg-black/20 hover:bg-white hover:text-black flex items-center justify-center transition-colors text-white/50" title="Copiar Link">
                                <i class="fa-solid fa-copy text-xs"></i>
                            </button>
                            <!-- Seta -->
                            <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center group-hover:bg-white group-hover:text-black transition-colors">
                                <i class="fa-solid fa-arrow-right -rotate-45 group-hover:rotate-0 transition-transform duration-300 text-xs"></i>
                            </div>
                        </div>
                    </div>
                `;

                // Eventos
                btn.querySelector('.copy-btn').onclick = (e) => {
                    e.stopPropagation();
                    navigator.clipboard.writeText(link.url);
                    showToast("Link copiado para a área de transferência!", "success");
                };

                btn.onclick = () => handleLinkClick(link);
                list.appendChild(btn);
            });
        }

        // --- LÓGICA DE AÇÃO & SEGURANÇA ---
        function handleLinkClick(link) {
            // Se não for download, libera geral
            if (link.type !== 'download') {
                window.open(link.url, '_blank');
                return;
            }

            // Verificação de Segurança Otimizada
            // 1. Verifica se está logado
            if (!state.user || state.user.isAnonymous) {
                state.pendingUrl = link.url;
                document.getElementById('auth-modal').classList.remove('hidden');
                return;
            }

            // 2. Verifica se é conta GOOGLE (Rigoroso)
            const isGoogle = state.user.providerData.some(p => p.providerId === 'google.com');

            if (isGoogle) {
                window.open(link.url, '_blank');
                showToast("Acesso liberado! Iniciando...", "success");
            } else {
                // Se estiver logado com outra coisa (ex: email/senha antigo), força logout
                signOut(auth);
                showToast("Apenas login com Google é permitido para downloads.", "error");
                document.getElementById('auth-modal').classList.remove('hidden');
            }
        }

        // --- SISTEMA DE BUSCA ---
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = state.links.filter(link => 
                link.title.toLowerCase().includes(term) || 
                link.type.toLowerCase().includes(term)
            );
            renderLinks(filtered);
        });

        // --- AUTH GOOGLE ---
        document.getElementById('btn-google').onclick = async () => {
            const provider = new GoogleAuthProvider();
            try {
                const result = await signInWithPopup(auth, provider);
                // Verifica novamente após login
                const isGoogle = result.user.providerData.some(p => p.providerId === 'google.com');
                
                if (isGoogle) {
                    closeAuthModal();
                    showToast(`Bem-vindo, ${result.user.displayName.split(' ')[0]}!`, "success");
                    if (state.pendingUrl) {
                        setTimeout(() => window.open(state.pendingUrl, '_blank'), 1000);
                        state.pendingUrl = null;
                    }
                    // Re-render para atualizar icones de cadeado
                    renderLinks(state.links);
                } else {
                    showToast("Erro: Use uma conta Google.", "error");
                    signOut(auth);
                }
            } catch (error) {
                showToast("Erro no login. Tente novamente.", "error");
                console.error(error);
            }
        };

        // --- UI UTILS ---
        function updateUserUI(user) {
            const statusText = document.getElementById('status-text');
            const statusDot = document.getElementById('status-dot');
            const pill = document.getElementById('user-pill');

            if (user && !user.isAnonymous) {
                statusText.textContent = "Membro Verificado";
                statusText.classList.add('text-green-400');
                statusDot.className = "w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e]";
                pill.onclick = () => {
                    if(confirm("Deseja sair da conta?")) signOut(auth).then(() => window.location.reload());
                };
            } else {
                statusText.textContent = "Visitante";
                statusText.classList.remove('text-green-400');
                statusDot.className = "w-2 h-2 rounded-full bg-yellow-500 animate-pulse";
                pill.onclick = null;
            }
        }

        window.showToast = (msg, type = "info") => {
            const toast = document.getElementById('toast');
            const title = document.getElementById('toast-title');
            const message = document.getElementById('toast-msg');
            const icon = document.getElementById('toast-icon');

            title.textContent = type === 'success' ? 'Sucesso' : type === 'error' ? 'Atenção' : 'Info';
            message.textContent = msg;
            
            // Cores
            toast.className = `toast glass border-l-4 flex items-center gap-3 text-left show ${type === 'success' ? 'border-brand-success' : type === 'error' ? 'border-brand-error' : 'border-brand-accent'}`;
            
            // Icone
            icon.innerHTML = type === 'success' ? '<i class="fa-solid fa-check-circle text-brand-success text-xl"></i>' : type === 'error' ? '<i class="fa-solid fa-triangle-exclamation text-brand-error text-xl"></i>' : '<i class="fa-solid fa-info-circle text-brand-accent text-xl"></i>';

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        };

        // Globals for HTML onclick
        window.acceptTerms = () => {
            localStorage.setItem('terms_accepted', 'true');
            document.getElementById('terms-modal').classList.add('hidden');
            init(); // Recarrega init para tentar login anonimo
        };

        window.closeAuthModal = () => {
            document.getElementById('auth-modal').classList.add('hidden');
        };

        // Start
        init();
    </script>
</body>
</html>
